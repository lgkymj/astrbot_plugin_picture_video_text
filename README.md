# 🖼️ AstrBot 图片/视频/文本管理插件

**本插件依托于大沙北大佬，结合DeepSeek进行二次开发**  
**大佬项目地址：https://github.com/bigshabei/astrbot_plugin_picture_manager**

**作者:** 代码工匠💻  
**版本:** v2.3.0  
**最后更新:** 2025年10月6日

## 📖 简介

一个功能强大的多内容类型管理插件，允许用户通过自定义触发指令从 API 获取图片、视频或文本内容。支持智能类型识别、批量处理、并发请求等高级特性。

## ✨ 核心特性

### 🎯 多内容类型支持
- **图片管理** - 支持 API 返回和直接图片链接
- **视频管理** - 自动识别视频内容并发送
- **文本内容** - 集成多种文本 API（名言、笑话、天气等）

### 🔧 智能功能
- **自动类型识别** - 根据 Content-Type 和文件扩展名智能识别媒体类型
- **批量转发** - 数量超过2个时自动使用转发消息格式
- **并发处理** - 支持多个 API 同时请求
- **重定向处理** - 自动处理 URL 重定向，获取最终资源

### ⚙️ 管理功能
- **可视化配置** - 通过 WebUI 管理插件开关和默认数量
- **数据持久化** - 所有配置自动保存，重启不丢失
- **灵活管理** - 支持增删改查所有内容源

## 🚀 快速开始

### 安装步骤

1. **克隆插件到指定目录**
```bash
cd AstrBot/data/plugins
git clone https://github.com/your-repo/astrbot_plugin_picture_manager.git
```

2. **重启 AstrBot** 或重新加载插件

3. **验证安装**
```
/看图帮助
```

### 基础配置

插件提供可视化配置界面，可通过 AstrBot WebUI 进行设置：

- **插件总开关**: 启用/禁用插件功能
- **默认数量**: 设置 `/看图` 指令的默认返回数量（最小为1）

## 📋 完整命令列表

### 🔄 状态控制
| 命令 | 参数 | 说明 | 示例 |
|------|------|------|------|
| `/开启看图` | 无 | 启用插件功能 | `/开启看图` |
| `/关闭看图` | 无 | 禁用插件功能 | `/关闭看图` |

### 👀 内容查看
| 命令 | 参数 | 说明 | 示例 |
|------|------|------|------|
| `/看图列表` | 无 | 查看所有可用内容源 | `/看图列表` |
| `/查看所有服务器` | 无 | **批量请求所有服务器API** | `/查看所有服务器` |

### ➕ 内容管理
| 命令 | 参数 | 说明 | 示例 |
|------|------|------|------|
| `/增加看图` | `触发指令 地址` | 智能添加内容（自动识别类型） | `/增加看图 猫咪 https://example.com/cat.jpg` |
| `/增加文本` | `触发指令 地址` | 专门添加文本API | `/增加文本 笑话 https://api.joke.com` |
| `/修改看图地址` | `触发指令 索引 新地址` | 修改指定内容源地址 | `/修改看图地址 猫咪 1 https://new.url` |
| `/删除看图` | `触发指令 [索引]` | 删除内容源（不填索引删除全部） | `/删除看图 猫咪 1` |

### 🎲 内容发送
| 命令 | 参数 | 说明 | 示例 |
|------|------|------|------|
| `/看图` | `触发指令 [数量]` | 获取指定数量图片/视频 | `/看图 猫咪 3` |
| `/文本` | `触发指令` | 获取文本内容 | `/文本 每日一言` |
| `/随机看图` | 无 | 随机发送任意类型内容 | `/随机看图` |
| `/随机文本` | 无 | 随机发送文本内容 | `/随机文本` |
| `触发指令` | 无 | **直接发送内容**（无需命令前缀） | `猫咪` |

### ❓ 帮助信息
| 命令 | 参数 | 说明 | 示例 |
|------|------|------|------|
| `/看图帮助` | 无 | 查看完整使用帮助 | `/看图帮助` |

## 🛠️ 详细使用指南

### 添加内容源

**智能添加（推荐）**
```
/增加看图 原神 https://api.example.com/genshin
```
插件会自动检测内容类型：
- 直接图片/视频链接 → 存入 `direct_url_list`
- 返回图片/视频链接的 API → 存入 `api_list`  
- 返回文本内容的 API → 存入 `text_api_list`

**指定类型添加**
```
/增加文本 天气预报 https://api.weather.com
```

### 批量服务器监控

`/查看所有服务器` 命令会：
1. 🔍 搜索所有包含"服务器"关键词的触发指令
2. ⚡ 并发请求所有相关 API
3. 📊 生成详细汇总报告
4. ✅ 显示每个 API 的请求状态和返回内容

### 高级使用技巧

**批量发送图片/视频**
```
/看图 小姐姐 5
```
- 数量 ≤ 2：直接发送
- 数量 > 2：使用转发消息格式

**直接触发（最便捷）**
```
原神          # 发送原神图片
每日一言       # 发送每日一言文本
随机看图       # 随机发送内容
```

## ⚙️ 配置文件说明

### 数据文件 (`api_config.json`)
```json
{
  "api_list": {
    "触发指令": ["API地址1", "API地址2"]
  },
  "direct_url_list": {
    "触发指令": ["直接媒体URL"]
  },
  "text_api_list": {
    "触发指令": ["文本API地址"]
  }
}
```

### 插件配置 (`_conf_schema.json`)
```json
{
  "enabled": {
    "description": "插件总开关",
    "type": "bool", 
    "default": true
  },
  "default_view_count": {
    "description": "默认发送数量",
    "type": "int",
    "default": 1
  }
}
```

## 🎨 预置内容源

### 图片/视频 API
- `原神` - 原神相关图片
- `黑丝`、`白丝` - 特定风格图片
- `小姐姐` - 美女图片/视频
- `小狐狸` - 动物图片

### 直接媒体链接  
- `樱花`、`二次元` - 动漫图片
- `jk`、`美腿` - 风格图片
- `mc` - 我的世界相关
- `电脑壁纸`、`手机壁纸` - 壁纸图片

### 文本 API
- `每日一言` - 励志名言
- `毒鸡汤` - 讽刺幽默
- `笑话` - 开心一刻
- `天气` - 天气信息
- `星座运势` - 星座运势

## ⚠️ 注意事项

### 使用限制
- 🚫 插件需开启后才能使用所有功能
- 🔒 每个触发指令在同类中必须唯一
- 📏 文本 API 应返回有效的 JSON 或纯文本内容
- 🌐 确保网络连接稳定，部分 API 可能需要代理

### 性能优化
- ⚡ 大量内容使用转发消息避免刷屏
- 🔄 并发请求提升响应速度  
- 💾 配置自动保存，避免数据丢失

### 错误处理
- ❌ 单个 API 失败不影响其他请求
- ⏱️ 请求超时自动跳过
- 📝 详细日志记录便于排查问题

## 🐛 故障排除

### 常见问题

**Q: 插件无响应**
```
A: 检查插件是否启用：/开启看图
```

**Q: 触发指令无效**
```
A: 查看可用指令：/看图列表
```

**Q: API 返回错误**
```
A: 检查网络连接和 API 地址有效性
```

**Q: 内容发送失败**
```
A: 查看日志获取详细错误信息
```

### 获取帮助
```
/看图帮助        # 查看完整帮助文档
```

## 🔄 更新日志

### v2.3.0 (当前版本)
- ✅ 新增批量服务器监控功能
- ✅ 增强内容类型识别能力  
- ✅ 优化并发请求性能
- ✅ 完善错误处理机制

### v2.0.0
- ✅ 支持视频内容发送
- ✅ 新增文本内容管理
- ✅ 重构代码架构
- ✅ 添加可视化配置

## 📞 技术支持

如有问题或建议，请：
1. 首先查看 `/看图帮助`
2. 检查插件配置和网络连接
3. 查看 AstrBot 日志文件

---

**享受使用 AstrBot 图片/视频/文本管理插件！** 🎉
